!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("eosjs"),require("fast-sha256")):"function"==typeof define&&define.amd?define(["exports","eosjs","fast-sha256"],t):t((e=e||self).eosioSigningRequest={},e.eosjs,e.sha256)}(this,function(e,t,n){function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return i(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,void 0):void 0}}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;for(var o={version:"eosio::abi/1.1",types:[{new_type_name:"account_name",type:"name"},{new_type_name:"action_name",type:"name"},{new_type_name:"permission_name",type:"name"},{new_type_name:"chain_alias",type:"uint8"},{new_type_name:"chain_id",type:"checksum256"},{new_type_name:"request_flags",type:"uint8"}],structs:[{name:"permission_level",fields:[{name:"actor",type:"account_name"},{name:"permission",type:"permission_name"}]},{name:"action",fields:[{name:"account",type:"account_name"},{name:"name",type:"action_name"},{name:"authorization",type:"permission_level[]"},{name:"data",type:"bytes"}]},{name:"extension",fields:[{name:"type",type:"uint16"},{name:"data",type:"bytes"}]},{name:"transaction_header",fields:[{name:"expiration",type:"time_point_sec"},{name:"ref_block_num",type:"uint16"},{name:"ref_block_prefix",type:"uint32"},{name:"max_net_usage_words",type:"varuint32"},{name:"max_cpu_usage_ms",type:"uint8"},{name:"delay_sec",type:"varuint32"}]},{name:"transaction",base:"transaction_header",fields:[{name:"context_free_actions",type:"action[]"},{name:"actions",type:"action[]"},{name:"transaction_extensions",type:"extension[]"}]},{name:"info_pair",fields:[{name:"key",type:"string"},{name:"value",type:"bytes"}]},{name:"signing_request",fields:[{name:"chain_id",type:"variant_id"},{name:"req",type:"variant_req"},{name:"flags",type:"request_flags"},{name:"callback",type:"string"},{name:"info",type:"info_pair[]"}]},{name:"identity",fields:[{name:"permission",type:"permission_level?"}]},{name:"request_signature",fields:[{name:"signer",type:"name"},{name:"signature",type:"signature"}]}],variants:[{name:"variant_id",types:["chain_alias","chain_id"]},{name:"variant_req",types:["action","action[]","transaction","identity"]}],actions:[{name:"identity",type:"identity"}]},s={__proto__:null,RequestFlagsNone:0,RequestFlagsBroadcast:1,RequestFlagsBackground:2,data:o},c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",u=new Uint8Array(256),f=0;f<64;f++)u[c.charCodeAt(f)]=f;var d,l=function(e,n,r,i){try{var a,s=function(i){var o=b(a);return t.Serialize.serializeAction(o,e.account,e.name,e.authorization,e.data,n,r)};if("string"==typeof e.data)return Promise.resolve(e);var c=function(){if(!_(e))return function(){if(i)return Promise.resolve(i.getAbi(e.account)).then(function(e){a=e});throw new Error("Missing abi provider")}();a=o}();return Promise.resolve(c&&c.then?c.then(s):s())}catch(e){return Promise.reject(e)}},h=t.Serialize.getTypesFromAbi(t.Serialize.createInitialTypes(),o);(d=e.ChainName||(e.ChainName={}))[d.UNKNOWN=0]="UNKNOWN",d[d.EOS=1]="EOS",d[d.TELOS=2]="TELOS",d[d.JUNGLE=3]="JUNGLE",d[d.KYLIN=4]="KYLIN",d[d.WORBLI=5]="WORBLI",d[d.BOS=6]="BOS",d[d.MEETONE=7]="MEETONE",d[d.INSIGHTS=8]="INSIGHTS",d[d.BEOS=9]="BEOS",d[d.WAX=10]="WAX",d[d.PROTON=11]="PROTON",d[d.FIO=12]="FIO";var p=new Map([[e.ChainName.EOS,"aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906"],[e.ChainName.TELOS,"4667b205c6838ef70ff7988f6e8257e8be0e1284a2f59699054a018f743b1d11"],[e.ChainName.JUNGLE,"e70aaab8997e1dfce58fbfac80cbbb8fecec7b99cf982a9444273cbc64c41473"],[e.ChainName.KYLIN,"5fff1dae8dc8e2fc4d5b23b2c7665c97f9e9d8edf2b6485a86ba311c25639191"],[e.ChainName.WORBLI,"73647cde120091e0a4b85bced2f3cfdb3041e266cbbe95cee59b73235a1b3b6f"],[e.ChainName.BOS,"d5a3d18fbb3c084e3b1f3fa98c21014b5f3db536cc15d08f9f6479517c6a3d86"],[e.ChainName.MEETONE,"cfe6486a83bad4962f232d48003b1824ab5665c36778141034d75e57b956e422"],[e.ChainName.INSIGHTS,"b042025541e25a472bffde2d62edd457b7e70cee943412b1ea0f044f88591664"],[e.ChainName.BEOS,"b912d19a6abd2b1b05611ae5be473355d64d95aeff0c09bedc8c166cd6468fe4"],[e.ChainName.WAX,"1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4"],[e.ChainName.PROTON,"384da888112027f0321850a169f737c33e53b388aad48b5adace4bab97f437e0"],[e.ChainName.FIO,"21dcae42c0182200e93f954a074011f9048a7624c6fe81d3c9541a614a88bd1c"]]),m={actor:"............1",permission:"............2"},v=function(){var e=function(){function e(e,t,n,r,i,a,o){if(0!=(1&t.flags)&&"identity"===t.req[0])throw new Error("Invalid request (identity request cannot be broadcast)");if(0==(1&t.flags)&&0===t.callback.length)throw new Error("Invalid request (nothing to do, no broadcast or callback set)");this.version=e,this.data=t,this.textEncoder=n,this.textDecoder=r,this.zlib=i,this.abiProvider=a,this.signature=o}e.create=function(t,n){void 0===n&&(n={});try{var r=function(r){if(o.chain_id=g(t.chainId),o.flags=0,(void 0===t.broadcast||t.broadcast)&&(o.flags|=1),"string"==typeof t.callback?o.callback=t.callback:"object"==typeof t.callback?(o.callback=t.callback.url,t.callback.background&&(o.flags|=2)):o.callback="",o.info=[],"object"==typeof t.info)for(var s in t.info)if(t.info.hasOwnProperty(s)){var c=t.info[s];if("string"!=typeof s)throw new Error("Invalid info dict, keys must be strings");"string"==typeof c&&(c=i.encode(c)),o.info.push({key:s,value:c})}var u=new e(2,o,i,a,n.zlib,n.abiProvider);return n.signatureProvider&&u.sign(n.signatureProvider),u},i=n.textEncoder||new TextEncoder,a=n.textDecoder||new TextDecoder,o={},s=function(e){return l(e,i,a,n.abiProvider)},c=function(){if(void 0===t.identity)return!t.action||t.actions||t.transaction?function(){if(!t.actions||t.action||t.transaction)return function(){if(!t.transaction||t.action||t.actions)throw new TypeError("Invalid arguments: Must have exactly one of action, actions or transaction");var e=t.transaction;return void 0===e.expiration&&(e.expiration="1970-01-01T00:00:00.000"),void 0===e.ref_block_num&&(e.ref_block_num=0),void 0===e.ref_block_prefix&&(e.ref_block_prefix=0),void 0===e.context_free_actions&&(e.context_free_actions=[]),void 0===e.transaction_extensions&&(e.transaction_extensions=[]),void 0===e.delay_sec&&(e.delay_sec=0),void 0===e.max_cpu_usage_ms&&(e.max_cpu_usage_ms=0),void 0===e.max_net_usage_words&&(e.max_net_usage_words=0),Promise.resolve(Promise.all(e.actions.map(s))).then(function(t){e.actions=t,o.req=["transaction",e]})}();var e=1===t.actions.length?Promise.resolve(s(t.actions[0])).then(function(e){o.req=["action",e]}):Promise.resolve(Promise.all(t.actions.map(s))).then(function(e){o.req=["action[]",e]});return e&&e.then?e.then(function(){}):void 0}():Promise.resolve(s(t.action)).then(function(e){o.req=["action",e]});o.req=["identity",t.identity]}();return Promise.resolve(c&&c.then?c.then(r):r())}catch(e){return Promise.reject(e)}},e.identity=function(e,t){void 0===t&&(t={});var n={actor:e.account||"............1",permission:e.permission||"............2"};return"............1"===n.actor&&"............2"===n.permission&&(n=null),this.create({identity:{permission:n},broadcast:!1,callback:e.callback,info:e.info},t)},e.fromTransaction=function(n,r,i){void 0===i&&(i={}),"string"!=typeof n&&(n=t.Serialize.arrayToHex(n)),"string"==typeof r&&(r=t.Serialize.hexToUint8Array(r));var a=new t.Serialize.SerialBuffer({textDecoder:i.textDecoder,textEncoder:i.textEncoder});a.push(2);var o=g(n);return"chain_alias"===o[0]?(a.push(0),a.push(o[1])):(a.push(1),a.pushArray(t.Serialize.hexToUint8Array(o[1]))),a.push(2),a.pushArray(r),a.push(1),a.push(0),a.push(0),e.fromData(a.asUint8Array(),i)},e.from=function(t,n){if(void 0===n&&(n={}),"string"!=typeof t)throw new Error("Invalid request uri");var r=t.split(":"),i=r[0],a=r[1];if("esr"!==i&&"web+esr"!==i)throw new Error("Invalid scheme");var o=function(e){for(var t,n,r,i,a=new Uint8Array(.75*e.length),o=0,s=0;s<e.length;s+=4)t=u[e.charCodeAt(s)],n=u[e.charCodeAt(s+1)],r=u[e.charCodeAt(s+2)],i=u[e.charCodeAt(s+3)],a[o++]=t<<2|n>>4,a[o++]=(15&n)<<4|r>>2,a[o++]=(3&r)<<6|63&i;return a}(a.startsWith("//")?a.slice(2):a);return e.fromData(o,n)},e.fromData=function(n,r){void 0===r&&(r={});var i=n[0],a=-129&i;if(2!==a)throw new Error("Unsupported protocol version");var o=n.slice(1);if(0!=(128&i)){if(!r.zlib)throw new Error("Compressed URI needs zlib");o=r.zlib.inflateRaw(o)}var s,c=r.textEncoder||new TextEncoder,u=r.textDecoder||new TextDecoder,f=new t.Serialize.SerialBuffer({textEncoder:c,textDecoder:u,array:o}),d=e.type.deserialize(f);return f.haveReadData()&&(s=h.get("request_signature").deserialize(f)),new e(a,d,c,u,r.zlib,r.abiProvider,s)};var i=e.prototype;return i.sign=function(e){var n=this.getSignatureDigest();this.signature=e.sign(t.Serialize.arrayToHex(n))},i.getSignatureDigest=function(){var e=new t.Serialize.SerialBuffer({textEncoder:this.textEncoder,textDecoder:this.textDecoder});return e.pushArray([this.version,114,101,113,117,101,115,116]),e.pushArray(this.getData()),n(e.asUint8Array())},i.setSignature=function(e,t){this.signature={signer:e,signature:t}},i.setCallback=function(e,t){this.data.callback=e,t?this.data.flags|=2:this.data.flags&=-3},i.setBroadcast=function(e){e?this.data.flags|=1:this.data.flags&=-2},i.encode=function(e,t){var n=void 0!==e?e:void 0!==this.zlib;if(n&&void 0===this.zlib)throw new Error("Need zlib to compress");var r=this.version,i=this.getData(),a=this.getSignatureData(),o=new Uint8Array(i.byteLength+a.byteLength);if(o.set(i,0),o.set(a,i.byteLength),n){var s=this.zlib.deflateRaw(o);o.byteLength>s.byteLength&&(r|=128,o=s)}var u=new Uint8Array(1+o.byteLength);u[0]=r,u.set(o,1);var f="esr:";return!1!==t&&(f+="//"),f+function(e){for(var t,n=e.byteLength,r=n%3,i=n-r,a=[],o=0;o<i;o+=3)a.push(c[(16515072&(t=e[o]<<16|e[o+1]<<8|e[o+2]))>>18]+c[(258048&t)>>12]+c[(4032&t)>>6]+c[63&t]);return 1===r?a.push(c[(252&(t=e[i]))>>2]+c[(3&t)<<4]):2===r&&a.push(c[(64512&(t=e[i]<<8|e[i+1]))>>10]+c[(1008&t)>>4]+c[(15&t)<<2]),a.join("")}(u)},i.getData=function(){var n=new t.Serialize.SerialBuffer({textEncoder:this.textEncoder,textDecoder:this.textDecoder});return e.type.serialize(n,this.data),n.asUint8Array()},i.getSignatureData=function(){if(!this.signature)return new Uint8Array(0);var e=new t.Serialize.SerialBuffer({textEncoder:this.textEncoder,textDecoder:this.textDecoder});return h.get("request_signature").serialize(e,this.signature),e.asUint8Array()},i.getRequiredAbis=function(){return this.getRawActions().filter(function(e){return!_(e)}).map(function(e){return e.account}).filter(function(e,t,n){return n.indexOf(e)===t})},i.requiresTapos=function(){var e=this.getRawTransaction();return!this.isIdentity()&&!x(e)},i.fetchAbis=function(e){try{var t=e||this.abiProvider;if(!t)throw new Error("Missing ABI provider");var n=new Map;return Promise.resolve(Promise.all(this.getRequiredAbis().map(function(e){try{var r=n.set;return Promise.resolve(t.getAbi(e)).then(function(t){r.call(n,e,t)})}catch(e){return Promise.reject(e)}}))).then(function(){return n})}catch(e){return Promise.reject(e)}},i.resolveActions=function(e,n){var r=this;return this.getRawActions().map(function(i){var a;if(!(a=_(i)?o:e.get(i.account)))throw new Error("Missing ABI definition for "+i.account);var s=b(a);n&&(s.types.get("name").deserialize=function(e){var t=e.getName();return"............1"===t?n.actor:"............2"===t?n.permission:t});var c=t.Serialize.deserializeAction(s,i.account,i.name,i.authorization,i.data,r.textEncoder,r.textDecoder);return n&&(c.authorization=c.authorization.map(function(e){var t=e.actor,r=e.permission;return"............1"===t&&(t=n.actor),"............2"===r&&(r=n.permission),"............1"===r&&(r=n.permission),{actor:t,permission:r}})),c})},i.resolveTransaction=function(e,n,i){void 0===i&&(i={});var a=this.getRawTransaction();if(!this.isIdentity()&&!x(a))if(void 0!==i.expiration&&void 0!==i.ref_block_num&&void 0!==i.ref_block_prefix)a.expiration=i.expiration,a.ref_block_num=i.ref_block_num,a.ref_block_prefix=i.ref_block_prefix;else{if(void 0===i.block_num||void 0===i.ref_block_prefix||void 0===i.timestamp)throw new Error("Invalid transaction context, need either a reference block or explicit TAPoS values");var o=t.Serialize.transactionHeader(i,void 0!==i.expire_seconds?i.expire_seconds:60);a.expiration=o.expiration,a.ref_block_num=o.ref_block_num,a.ref_block_prefix=o.ref_block_prefix}var s=this.resolveActions(e,n);return r(r({},a),{},{actions:s})},i.resolve=function(n,i,a){var s=this;void 0===a&&(a={});var c=this.resolveTransaction(n,i,a),u=new t.Serialize.SerialBuffer({textDecoder:this.textDecoder,textEncoder:this.textEncoder}),f=c.actions.map(function(e){var r;if(!(r=_(e)?o:n.get(e.account)))throw new Error("Missing ABI definition for "+e.account);var i=b(r);return t.Serialize.serializeAction(i,e.account,e.name,e.authorization,e.data,s.textEncoder,s.textDecoder)});e.transactionType.serialize(u,r(r({},c),{},{actions:f}));var d=u.asUint8Array();return new y(this,i,c,d)},i.getChainId=function(){var e=this.data.chain_id;switch(e[0]){case"chain_id":return e[1];case"chain_alias":if(p.has(e[1]))return p.get(e[1]);throw new Error("Unknown chain id alias");default:throw new Error("Invalid signing request data")}},i.getRawActions=function(){var n=this.data.req;switch(n[0]){case"action":return[n[1]];case"action[]":return n[1];case"identity":var r="0101000000000000000200000000000000",i=[m];if(n[1].permission){var a=new t.Serialize.SerialBuffer({textDecoder:this.textDecoder,textEncoder:this.textEncoder});e.idType.serialize(a,n[1]),r=t.Serialize.arrayToHex(a.asUint8Array()),i=[n[1].permission]}return[{account:"",name:"identity",authorization:i,data:r}];case"transaction":return n[1].actions;default:throw new Error("Invalid signing request data")}},i.getRawTransaction=function(){var e=this.data.req;switch(e[0]){case"transaction":return e[1];case"action":case"action[]":case"identity":return{actions:this.getRawActions(),context_free_actions:[],transaction_extensions:[],expiration:"1970-01-01T00:00:00.000",ref_block_num:0,ref_block_prefix:0,max_cpu_usage_ms:0,max_net_usage_words:0,delay_sec:0};default:throw new Error("Invalid signing request data")}},i.isIdentity=function(){return"identity"===this.data.req[0]},i.shouldBroadcast=function(){return!this.isIdentity()&&0!=(1&this.data.flags)},i.getIdentity=function(){if("identity"===this.data.req[0]&&this.data.req[1].permission){var e=this.data.req[1].permission.actor;return"............1"===e?null:e}return null},i.getIdentityPermission=function(){if("identity"===this.data.req[0]&&this.data.req[1].permission){var e=this.data.req[1].permission.permission;return"............1"===e?null:e}return null},i.getRawInfo=function(){for(var e,n={},r=a(this.data.info);!(e=r()).done;){var i=e.value,o=i.value;n[i.key]="string"==typeof o?t.Serialize.hexToUint8Array(o):o}return n},i.getInfo=function(){for(var e={},t=this.getRawInfo(),n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];e[i]=this.textDecoder.decode(t[i])}return e},i.setInfoKey=function(e,t){var n,r=this.data.info.find(function(t){return t.key===e});switch(typeof t){case"string":n=this.textEncoder.encode(t);break;case"boolean":n=new Uint8Array([t?1:0]);break;default:throw new TypeError("Invalid value type, expected string or boolean.")}r?r.value=n:this.data.info.push(r={key:e,value:n})},i.clone=function(){var t;this.signature&&(t=JSON.parse(JSON.stringify(this.signature)));var n=JSON.stringify(this.data,function(e,t){return t instanceof Uint8Array?Array.from(t):t});return new e(this.version,JSON.parse(n),this.textEncoder,this.textDecoder,this.zlib,this.abiProvider,t)},i.toString=function(){return this.encode()},i.toJSON=function(){return this.encode()},e}();return e.type=h.get("signing_request"),e.idType=h.get("identity"),e.transactionType=h.get("transaction"),e}(),y=function(){function e(e,t,n,r){this.request=e,this.signer=t,this.transaction=n,this.serializedTransaction=r}e.fromPayload=function(e,t){void 0===t&&(t={});try{var n=v.from(e.req,t);return Promise.resolve(n.fetchAbis()).then(function(t){return n.resolve(t,{actor:e.sa,permission:e.sp},{ref_block_num:Number(e.rbn),ref_block_prefix:Number(e.rid),expiration:e.ex})})}catch(e){return Promise.reject(e)}};var r=e.prototype;return r.getTransactionId=function(){return t.Serialize.arrayToHex(n(this.serializedTransaction))},r.getCallback=function(e,t){var n=this.request.data,r=n.callback,i=n.flags;if(!r||0===r.length)return null;if(!e||0===e.length)throw new Error("Must have at least one signature to resolve callback");for(var o,s={sig:e[0],tx:this.getTransactionId(),rbn:String(this.transaction.ref_block_num),rid:String(this.transaction.ref_block_prefix),ex:this.transaction.expiration,req:this.request.encode(),sa:this.signer.actor,sp:this.signer.permission},c=a(e.slice(1).entries());!(o=c()).done;){var u=o.value;s["sig"+u[0]]=u[1]}t&&(s.bn=String(t));var f=r.replace(/({{([a-z0-9]+)}})/g,function(e,t,n){return s[n]||""});return{background:0!=(2&i),payload:s,url:f}},e}();function b(e){for(var n,r=t.Serialize.getTypesFromAbi(t.Serialize.createInitialTypes(),e),i=new Map,o=a(e.actions);!(n=o()).done;){var s=n.value;i.set(s.name,t.Serialize.getType(r,s.type))}return{types:r,actions:i}}function g(t){if(t||(t=e.ChainName.EOS),"number"==typeof t)return["chain_alias",t];var n=w(t);return n!==e.ChainName.UNKNOWN?["chain_alias",n]:["chain_id",t]}function _(e){return""===e.account&&"identity"===e.name}function x(e){return!("1970-01-01T00:00:00.000"===e.expiration&&0===e.ref_block_num&&0===e.ref_block_prefix)}function w(t){t=t.toLowerCase();for(var n=a(p);!n().done;);return e.ChainName.UNKNOWN}e.PlaceholderAuth=m,e.PlaceholderName="............1",e.PlaceholderPermission="............2",e.ResolvedSigningRequest=y,e.SigningRequest=v,e.abi=s,e.idToName=w,e.nameToId=function(e){return p.get(e)||"0000000000000000000000000000000000000000000000000000000000000000"}});
//# sourceMappingURL=index.umd.js.map
